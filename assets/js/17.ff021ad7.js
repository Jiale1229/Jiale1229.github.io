(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{421:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"title"},[t._v("简介")]),s("p",[s("strong",[t._v("GitHub Actions")]),t._v(" 是一个持续集成"),s("code",[t._v("CI")]),t._v(" (Continuous integration)和持续交付"),s("code",[t._v("CD")]),t._v(" (Continuous delivery)的平台，它可以做到自动化构建、测试、部署等等。GitHub把这些操作称为 "),s("strong",[t._v("Actions")]),t._v("。")])]),t._v(" "),s("h2",{attrs:{id:"概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[t._v("#")]),t._v(" 概念")]),t._v(" "),s("p",[t._v("一个仓库可以配置一个或者多个 "),s("code",[t._v("GitHub Actions")]),t._v(" "),s("strong",[t._v("工作流（workflow）")]),t._v(" ，它会在你的仓库发生某个事件时被触发，就比如一个 "),s("code",[t._v("pull request")]),t._v(" 或者一个 "),s("code",[t._v("issue")]),t._v(" 被创建的时候。")]),t._v(" "),s("p",[t._v("工作流包含一个或者多个"),s("strong",[t._v("任务（jobs）")]),t._v("， 它们可以并行或者串行执行。每一个任务（jobs）都运行在虚拟机环境，任务可以有一个或者多个 "),s("strong",[t._v("步骤（steps）")]),t._v(" ，可以运行一个自定义的脚本或者运行一个 "),s("strong",[t._v("动作（action）")]),t._v(" ，所谓动作（action）是一个可复用的扩展，用于简化你的工作流。\n"),s("img",{attrs:{"data-src":"https://cdn.staticaly.com/gh/Jiale1229/PicGoCdn@master/images/actions/overview-actions-simple.png"}})]),t._v(" "),s("h2",{attrs:{id:"术语"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#术语"}},[t._v("#")]),t._v(" 术语")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("workflow （工作流）：")]),t._v(" 一个可配置的自动化过程，它将运行一个或多个任务。由"),s("code",[t._v("项目根目录/.github/workflows")]),t._v("路径下的 "),s("code",[t._v(".yml")]),t._v(" 文件定义，一个 workflow对应一个具体的.yml 文件")]),t._v(" "),s("li",[s("strong",[t._v("job （任务）：")]),t._v(" 一个工作流程中包含一个或多个job ，每个 job包含一系列的 steps 步骤。")]),t._v(" "),s("li",[s("strong",[t._v("step（步骤）：")]),t._v(" 每个 step 步骤可以执行指令或者使用一个 action 动作。")]),t._v(" "),s("li",[s("strong",[t._v("action （动作）：")]),t._v(" 动作是 GitHub Actions 平台的一个自定义的应用，它会执行一个复杂但是需要频繁重复的作业。使用动作可以减少重复代码。可以自己写，也可以在 "),s("a",{attrs:{href:"https://github.com/marketplace?type=actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方市场"),s("OutboundLink")],1),t._v(" 可以搜索到他人提交的 actions，直接引用即可")])]),t._v(" "),s("h2",{attrs:{id:"关于yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于yml"}},[t._v("#")]),t._v(" 关于Yml")]),t._v(" "),s("p",[t._v("yml是YAML（YAML Ain’t Markup Language）语言的文件，以数据为中心，比properties、xml等更适合做配置文件，主要有以下几个特点:")]),t._v(" "),s("ul",[s("li",[t._v("大小写敏感。")]),t._v(" "),s("li",[t._v("使用缩进表示层级关系。")]),t._v(" "),s("li",[t._v("缩进只能使用空格，不能用 TAB 字符。")]),t._v(" "),s("li",[t._v("缩进的空格数量不重要，只要层级相同的元素左对齐即可。")]),t._v(" "),s("li",[t._v("‘#’ 表示注释。")])]),t._v(" "),s("h2",{attrs:{id:"语法简述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#语法简述"}},[t._v("#")]),t._v(" 语法简述")]),t._v(" "),s("p",[t._v("workflow 文件的配置字段非常多，详见"),s("a",{attrs:{href:"https://help.github.com/en/articles/workflow-syntax-for-github-actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),s("OutboundLink")],1),t._v("。下面是一些基本字段。")]),t._v(" "),s("h3",{attrs:{id:"name"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#name"}},[t._v("#")]),t._v(" name")]),t._v(" "),s("p",[t._v("工作流程（workflow）的名称，会在 GitHub 相应的 UI 界面上显示。 如果省略 "),s("code",[t._v("name")]),t._v("，GitHub 会将其设置为相对于仓库根目录的工作流程文件路径。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy GitHub Pages\n")])])]),s("h3",{attrs:{id:"on"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#on"}},[t._v("#")]),t._v(" on")]),t._v(" "),s("p",[t._v("指定触发 workflow 的条件，通常是某些事件。更多可用事件的列表，请参阅“"),s("a",{attrs:{href:"https://docs.github.com/cn/articles/events-that-trigger-workflows",target:"_blank",rel:"noopener noreferrer"}},[t._v("触发工作流程的事件"),s("OutboundLink")],1),t._v("”。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 单个事件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" push "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在代码仓库Push时触发")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 多个事件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("push"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" merge"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#push和merge时触发")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定触发事件时，可以限定分支或标签。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" main  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 只有在 main 分支发生 push 事件时触发")]),t._v("\n\n")])])]),s("h3",{attrs:{id:"jobs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jobs"}},[t._v("#")]),t._v(" jobs")]),t._v(" "),s("p",[t._v("workflow 文件的主体是"),s("code",[t._v("jobs")]),t._v("字段， 包含当前工作流程中的所有任务，每个任务会在 "),s("code",[t._v("runs-on")]),t._v(" 指定的运行器环境中运行")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("jobs.<job_id>")])]),t._v(" "),s("p",[s("code",[t._v("jobs")]),t._v("字段里面，需要写出每一项任务的"),s("code",[t._v("job_id")]),t._v("，具体名称自定义。必须以字母或"),s("code",[t._v("_")]),t._v("开头，并且只能包含字母数字字符、"),s("code",[t._v("-")]),t._v("或"),s("code",[t._v("_")]),t._v("。")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# <job_id>")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# <job_id>")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v(" \n")])])]),s("ul",[s("li",[s("p",[s("strong",[t._v("jobs.<job_id>.needs")])]),t._v(" "),s("p",[t._v("每一个Job都是并发执行的并不是按照申明的先后顺序执行的， 如果多个job 之间存在依赖关系，那么就需要使用"),s("code",[t._v("needs")]),t._v("字段指定当前任务的依赖关系，即运行顺序。")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("needs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" job1\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("needs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("job1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" job2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("上面代码中，job1必须先于job2完成，而job3等待job1和job2的完成才能运行。因此，这个 workflow 的运行顺序依次为：job1、job2、job3。")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("jobs.<job_id>.runs-on")])]),t._v(" "),s("p",[s("code",[t._v("runs-on")]),t._v("字段指定运行所需要的虚拟机环境。它是必填字段。目前可用的虚拟机如下。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("ubuntu-latest")]),t._v("，"),s("code",[t._v("ubuntu-18.04")]),t._v("或"),s("code",[t._v("ubuntu-16.04")])]),t._v(" "),s("li",[s("code",[t._v("windows-latest")]),t._v("，"),s("code",[t._v("windows-2019")]),t._v("或"),s("code",[t._v("windows-2016")])]),t._v(" "),s("li",[s("code",[t._v("macOS-latest")]),t._v("或"),s("code",[t._v("macOS-10.14")])])])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 任务运行的服务器环境：最新版 Ubuntu")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n")])])]),s("ul",[s("li",[s("p",[s("strong",[t._v("jobs.<job_id>.steps")])]),t._v(" "),s("p",[s("code",[t._v("steps")]),t._v("字段指定每个 Job 的运行步骤，可以包含一个或多个步骤。每个步骤都可以指定以下三个字段。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("jobs.<job_id>.steps.name")]),t._v("：步骤名称。")]),t._v(" "),s("li",[s("code",[t._v("jobs.<job_id>.steps.run")]),t._v("：该步骤运行的命令或者 action。")]),t._v(" "),s("li",[s("code",[t._v("jobs.<job_id>.steps.env")]),t._v("：该步骤所需的环境变量。")])]),t._v(" "),s("p",[t._v("当然，也可以使用其他大佬封装好的 action，详见 "),s("a",{attrs:{href:"https://github.com/marketplace?type=actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("actions 市场"),s("OutboundLink")],1),t._v("。")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 步骤名称 拉取当前库的代码")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Checkout 🛎️\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 步骤所依赖的操作库 这里引用了官方发布的git操作库 将对应仓库的源码克隆到当前工作流中")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v3\n")])])]),s("h2",{attrs:{id:"敏感数据的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#敏感数据的使用"}},[t._v("#")]),t._v(" 敏感数据的使用")]),t._v(" "),s("p",[t._v("在持续集成的过程中，我们可能会使用到自己的敏感数据，比如服务器的 IP、服务器的用户名、服务器的密码等信息，出于安全考虑，这些数据不应该直接写在文件中以防泄露，而是需要从 GitHub 的 Secrets变量中读取。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 部署到自己的服务器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看 workflow 的文档来获取更多信息")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# https://github.com/marketplace/actions/ssh-deploy")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy MY Server 🌐\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" easingthemes/ssh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("deploy@v2.2.11\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("SSH_PRIVATE_KEY")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.SSH_PRIVATE_KEY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务器SSH私钥")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("REMOTE_HOST")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.REMOTE_HOST "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务器域名")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TARGET")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.TARGET "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务器静态文件存放的目录")]),t._v("\n   \t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("REMOTE_PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.REMOTE_PORT "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 端口")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("REMOTE_USER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 一般默认用户名为root")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("SOURCE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" public "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 静态文件的输出目录")]),t._v("\n")])])]),s("h3",{attrs:{id:"配置-github-secrets变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-github-secrets变量"}},[t._v("#")]),t._v(" 配置 GitHub Secrets变量")]),t._v(" "),s("p",[t._v("在当前仓库依次点击  "),s("strong",[t._v("Settings")]),t._v(" -> "),s("strong",[t._v("Secrets")]),t._v(" -> "),s("strong",[t._v("Actions")]),t._v(" -> "),s("strong",[t._v("New repository secret")]),t._v(" 环境变量的名字可以随便起，脚本里的变量名也要与之对应\n"),s("img",{attrs:{"data-src":"https://cdn.staticaly.com/gh/Jiale1229/PicGoCdn@master/images/reco/secrets4.png"}})]),t._v(" "),s("h2",{attrs:{id:"完活"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#完活"}},[t._v("#")]),t._v(" 完活")]),t._v(" "),s("img",{attrs:{"data-src":"https://cdn.staticaly.com/gh/Jiale1229/PicGoCdn@master/images/actions/bq.png"}})])}),[],!1,null,null,null);s.default=e.exports}}]);